{% load static i18n %}
<link rel="stylesheet" href="{% static 'css/kv-hero.css' %}">
<link rel="stylesheet" href="{% static 'css/ui/buttons.css' %}">
<link rel="stylesheet" href="{% static 'css/ui/plan-orbs.css' %}">
<style>
  #hero-video-play-overlay {
  -webkit-tap-highlight-color: transparent;
}
#hero-video-play-overlay svg { filter: drop-shadow(0 2px 8px rgba(0,0,0,.45)); }

</style>
<section class="kv-hero mt-[-30px] relative overflow-hidden">
  <!-- ðŸ”¹ Hafif: Arka plan video (lazy + poster + guardrails) -->
  <div class="kv-video-layer pointer-events-none absolute inset-0 -z-10 overflow-hidden" aria-hidden="true">
  <video id="hero-video" muted loop playsinline webkit-playsinline preload="none" poster="{% static 'img/hero-poster.jpg' %}" class="w-full h-full object-cover">
    <source data-src="{% static 'videos/hero-animation.webm' %}" type="video/webm">
    <source data-src="{% static 'videos/hero-animation.mp4' %}" type="video/mp4">
  </video>

    <!-- Kontrast iÃ§in yumuÅŸak overlay -->
    <div class="absolute inset-0 bg-gradient-to-b
                from-white/70 via-white/20 to-white/70
                dark:from-neutral-950/80 dark:via-neutral-950/35 dark:to-neutral-950/85"></div>

    <!-- JS kapalÄ±ysa poster gÃ¶sterilsin -->
    <noscript>
      <img src="{% static 'img/hero-poster.jpg' %}" alt="" class="w-full h-full object-cover" />
    </noscript>
  </div>

  <div class="kv-bg" style="opacity: 0.8;"></div>

  <!-- Orblar -->
  <div class="kv-orbs" aria-hidden="true">
    <span class="kv-orb kv-orb--tl"></span>
    <span class="kv-orb kv-orb--br"></span>
  </div>

  <div class="kv-content">
    <!-- Sol -->
    <div class="space-y-7 md:space-y-9">
      <!-- logo -->
      <div class="flex items-center gap-3">
        <img src="{% static 'img/favicon.ico' %}" class="h-10 w-10 rounded-lg bg-black/5 dark:bg-white/10 p-1" alt="">
      </div>

      <!-- BaÅŸlÄ±k -->
      <h1 class="kv-headline">
        {% trans "Coolvpn is Private. Fast. & Yours." %}
      </h1>

      <!-- KÄ±sa tagline -->
      <p class="kv-tagline max-w-xl">
        {% trans "One-tap connect. No-logs. No limits. CoolVPN." %}
      </p>

      <!-- ðŸ”¥ Bu aya Ã¶zel fiyat bandÄ± -->
      <div class="kv-deal mt-4 md:mt-6">
        <div class="kv-pill">
          <span class="kv-pill-hot">{% trans "This month only" %}</span>
          <span class="kv-dot" aria-hidden="true"></span>
          <span class="kv-pill-save">{% trans "Save 44%" %}</span>
        </div>

        <div class="kv-price-row">
          <div class="kv-price-main" aria-label="{% trans 'Current price' %}">
            <span class="kv-currency">{{ ui_currency_symbol }}</span>
            <span class="kv-amount">{{ui_monthly}}</span>
            <span class="kv-unit">/mo</span>
          </div>

          <div class="kv-price-compare">
            {% if old_monthly %}
              <del class="kv-old">{{ ui_currency_symbol }}{{ old_monthly }}</del>
            {% endif %}
            <span class="kv-badge-yr">
              {% blocktrans with sym=ui_currency_symbol yr=ui_annual %}or {{ sym }}{{ yr }}/year{% endblocktrans %}
            </span>
          </div>
        </div>

        <!-- CTAâ€™lar -->
        <div class="kv-deal-ctas sm:flex sm:items-center sm:justify-center">
          <a href="{% url 'pricing' %}" class="button-64 text-white w-[33%] -lg sm:w-full" style="color:white;">
            <span class="text">
              {% trans "Get Started" %}
              <svg style="color: white;" xmlns="http://www.w3.org/2000/svg" class="h-5 text-white w-5 ml-2 rtl:rotate-180" viewBox="0 0 24 24"
                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                aria-hidden="true">
                <path d="M5 12h14" />
                <path d="M12 5l7 7-7 7" />
              </svg>
            </span>
          </a>

          <a href="{% url 'features:stealth' %}" class="flex items-center kv-btn kv-btn--ghost w-full sm:w-auto dark:text-white">
            {% trans "See How It Works" %}
          </a>
        </div>

        <!-- mini gÃ¼ven satÄ±rÄ± -->
        <ul class="kv-deal-bullets" role="list">
          <li>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M9 16.2 4.8 12l-1.4 1.4L9 19l12-12-1.4-1.4z" />
            </svg>
            {% trans "No-logs policy" %}
          </li>
          <li>
            <svg viewBox="0 0 24 24" aria-hidden="true">
              <path d="M5 12h14M12 5l7 7-7 7" />
            </svg>
            {% trans "1-tap connect" %}
          </li>
          <li>
            <svg viewBox="0 0 24 24" width="16" height="16" aria-hidden="true">
              <circle cx="12" cy="12" r="8" fill="none" stroke="currentColor" stroke-width="2" />
              <path d="M12 12 L17 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
              <circle cx="12" cy="12" r="1.6" fill="currentColor" />
            </svg>
            {% trans "Blazing speed" %}
          </li>
        </ul>
      </div>

      <!-- 2Ã—2 Feature Grid (kÄ±sa) -->
      <div class="pt-2 md:pt-4 grid grid-cols-1 sm:grid-cols-2 gap-x-10 gap-y-5">
        <div class="flex items-center gap-3">
          <div class="kv-cap">
            <svg class="h-5 w-5 text-emerald-400" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M9 16.2 4.8 12l-1.4 1.4L9 19l12-12-1.4-1.4z" />
            </svg>
          </div>
          <h3 class="kv-feature">{% trans "Ad & Tracker Blocking" %}</h3>
        </div>

        <div class="flex items-center gap-3">
          <div class="kv-cap">
            <svg class="h-5 w-5 text-emerald-400" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M3 12h18v2H3zM3 7h18v2H3zM3 17h12v2H3z" />
            </svg>
          </div>
          <h3 class="kv-feature">{% trans "1000 Gbps Backbone" %}</h3>
        </div>

        <div class="flex items-center gap-3">
          <div class="kv-cap">
            <svg class="h-5 w-5 text-emerald-400" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 2 3 6v6c0 5 3.8 9.4 9 10 5.2-.6 9-5 9-10V6l-9-4Z" />
            </svg>
          </div>
          <h3 class="kv-feature">{% trans "Zero-Logs. Anonymous." %}</h3>
        </div>

        <div class="flex items-center gap-3">
          <div class="kv-cap">
            <svg class="h-5 w-5 text-emerald-400" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
              <path d="M12 2a1 1 0 0 1 1 1v1.06c1.39.2 2.5.86 3.28 1.81.37.43.32 1.09-.11 1.47a1 1 0 0 1-1.43-.1c-.5-.58-1.29-1.04-2.27-1.2v4.6c2.28.44 4 1.46 4 3.76 0 2.03-1.7 3.47-4 3.86V21a1 1 0 0 1-2 0v-1.14c-1.47-.18-2.79-.84-3.66-1.91a1 1 0 1 1 1.52-1.3c.63.73 1.61 1.22 2.64 1.38v-4.72c-2.34-.47-4-1.55-4-3.72 0-2 1.6-3.43 4-3.82V3a1 1 0 0 1 1-1Zm1 9.23V6.96c-1.38.27-2 .96-2 1.83 0 .84.62 1.4 2 1.88Zm-2 3.61v4.1c1.38-.27 2-.92 2-1.83 0-.9-.62-1.46-2-1.94Z"/>
            </svg>
          </div>
          <h3 class="kv-feature">{% trans "Smart, Fair Pricing" %}</h3>
        </div>
      </div>
    </div>

    <!-- SaÄŸ: GÃ¶rsel (kaldÄ±rÄ±ldÄ±) -->
    <!-- <figure class="kv-figure"> â€¦ </figure> -->
  </div>
</section>

<!-- Hafif video kontrolÃ¼ (lazy-load, intersection, reduce-motion/data, tab visibility) -->
<script>
// hero-video.js (place in your static/js/ and include with defer)
// Self-contained, IIFE, works with your existing .kv-video-layer and <video><source data-src="...">

(function () {
  'use strict';

  function getVideoElements() {
    const wrapper = document.querySelector('.kv-video-layer');
    const video = wrapper?.querySelector('video');
    return { wrapper, video };
  }

  function isMobile() {
    return /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
  }

  function createPlayOverlay(video) {
    if (!video || document.getElementById('hero-video-play-overlay')) return null;

    const overlay = document.createElement('button');
    overlay.id = 'hero-video-play-overlay';
    overlay.type = 'button';
    overlay.setAttribute('aria-label', 'Play background video');
    Object.assign(overlay.style, {
      position: 'absolute',
      inset: '0',
      zIndex: 30,
      display: 'flex',
      alignItems: 'center',
      justifyContent: 'center',
      background: 'linear-gradient(0deg, rgba(0,0,0,0.18), rgba(0,0,0,0.0))',
      border: 'none',
      padding: 0,
      cursor: 'pointer',
    });

    overlay.innerHTML = `<svg width="72" height="72" viewBox="0 0 24 24" fill="none" aria-hidden="true">
      <circle cx="12" cy="12" r="11" stroke="rgba(255,255,255,0.32)" stroke-width="1.5" fill="rgba(0,0,0,0.22)"/>
      <path d="M10 8v8l6-4-6-4z" fill="white"/>
    </svg>`;

    overlay.addEventListener('click', async (ev) => {
      ev.preventDefault();
      overlay.style.pointerEvents = 'none';
      try {
        video.muted = true;
        await injectSourcesOnce(video);
        await video.play();
        overlay.remove();
      } catch (err) {
        // restore interactivity if failed
        overlay.style.pointerEvents = '';
        console.warn('Manual play failed', err);
      }
    }, { once: true });

    // attach to video's parent
    const parent = video.parentElement || document.body;
    parent.style.position = parent.style.position || 'relative';
    parent.appendChild(overlay);
    return overlay;
  }

  // source injector singleton - returns Promise (for awaiting in overlay click)
  async function injectSourcesOnce(video) {
    if (!video) return;
    if (video._sourcesInjected) return;
    video._sourcesInjected = true;
    const sources = Array.from(video.querySelectorAll('source'));
    sources.forEach(s => {
      const ds = s.getAttribute('data-src');
      if (ds) s.setAttribute('src', ds);
    });
    try { video.load(); } catch (e) { /* ignore */ }
  }

  async function tryAutoplay(video, lowBandwidthMode) {
    if (!video) return false;
    if (lowBandwidthMode) return false;

    await injectSourcesOnce(video);

    try {
      // ensure attributes for mobile/iOS behavior
      try { video.muted = true; } catch (e) {}
      try { video.playsInline = true; } catch (e) {}
      video.setAttribute?.('playsinline', '');
      video.setAttribute?.('webkit-playsinline', '');

      const p = video.play();
      if (p instanceof Promise) await p;
      return true;
    } catch (err) {
      return false;
    }
  }

  // small util to check reduced data/motion & connection info
  function getLowBandwidthBool(video) {
    const prefersReducedMotion = window.matchMedia?.('(prefers-reduced-motion: reduce)').matches;
    const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
    const saveData = connection?.saveData === true;
    const effectiveType = (connection?.effectiveType || '').toLowerCase();
    const lowNetwork = ['slow-2g', '2g'].includes(effectiveType);
    const mobile = isMobile();
    // also skip heavy video for small mobile screens optionally
    return prefersReducedMotion || saveData || lowNetwork || (mobile && effectiveType === '3g');
  }

  // main entry - DOMContentLoaded safe if script included defer, but keep guard
  function boot() {
    const { wrapper, video } = getVideoElements();
    if (!video) return;

    const lowBandwidthMode = getLowBandwidthBool(video);

    if (lowBandwidthMode) {
      // do not load heavy sources, keep poster; ensure paused
      try { video.pause(); } catch (e) {}
      video.removeAttribute?.('autoplay');
      return;
    }

    let playedOnce = false;
    const io = new IntersectionObserver(async (entries, obs) => {
      for (const entry of entries) {
        if (!entry.isIntersecting) continue;
        obs.unobserve(entry.target);

        // try autoplay
        const ok = await tryAutoplay(video, lowBandwidthMode);
        playedOnce = !!ok;
        if (!ok) {
          // show overlay so user can tap to start playback
          createPlayOverlay(video);
        }
      }
    }, { threshold: 0.12 });

    io.observe(video);

    // visibility handling: pause when hidden, resume if in-view when visible
    document.addEventListener('visibilitychange', () => {
      if (document.hidden) {
        try { video.pause(); } catch (e) {}
      } else {
        // if we previously injected sources and in view, try to play
        const rect = video.getBoundingClientRect();
        const inView = rect.bottom > 0 && rect.top < (window.innerHeight || document.documentElement.clientHeight);
        if (inView && video._sourcesInjected) {
          video.muted = true;
          video.play().catch(() => {
            // if still blocked, ensure overlay present
            createPlayOverlay(video);
          });
        }
      }
    }, { passive: true });

    // watch for prefers-reduced-motion changes and pause if user turns on reduced-motion
    try {
      const rm = window.matchMedia('(prefers-reduced-motion: reduce)');
      rm.addEventListener?.('change', e => {
        if (e.matches) { try { video.pause(); } catch (e) {} }
      });
    } catch (e) { /* ignore */ }

    // fallback timeout: if video not playing after X ms, show overlay
    setTimeout(() => {
      if (!playedOnce && (video.paused || video.readyState < 3)) {
        createPlayOverlay(video);
      }
    }, 8000);
  }

  // If script loaded with defer, DOMContentLoaded might already have fired; safe guard:
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', boot, { once: true });
  } else {
    // DOM already ready
    setTimeout(boot, 0);
  }
})();

</script>
