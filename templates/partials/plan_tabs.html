{# templates/partials/plan_tabs.html #}
{% load i18n %}

<section id="plans"
  aria-labelledby="plans-title"
  class="relative isolate pb-12 md:pb-16"> {# ðŸ‘ˆ gap kontrollÃ¼: alt padding eklendi #}
  <div class="pointer-events-none absolute inset-0 -z-10" aria-hidden="true">
    <div
      class="absolute z-10 -top-24 -left-24 h-72 w-72 rounded-full bg-emerald-400/25 blur-3xl dark:bg-emerald-500/20"
      style="z-index: 30;"></div>
    <div
      class="absolute z-10 -bottom-24 h-80 w-80 rounded-full bg-indigo-400/25 blur-3xl dark:bg-indigo-500/20"
      style="z-index: 50;"></div>
    <div
      class="absolute z-10 inset-0 bg-gradient-to-b from-white via-white/70 to-white dark:from-black dark:via-black/70 dark:to-black"
      style="z-index: 10;"></div>
  </div>

  <div class="pointer-events-none absolute inset-x-0 top-0 h-8 -z-10
              bg-gradient-to-b from-transparent to-white/80 dark:to-black/80"></div>

  <div class="max-w-screen-xl mx-auto px-6">
    <!-- baÅŸlÄ±k -->
    <div class="text-center mb-8">
      <h2 id="plans-title"
        class="text-3xl md:text-4xl font-semibold tracking-tight text-gray-900 dark:text-gray-100">
        {% trans "Choose Your Plan" %}
      </h2>
      <p class="mt-3 text-gray-700 dark:text-gray-300">
        {% trans "Fast setup, no-logs, unlimited bandwidth â€” pick what fits you." %}
      </p>
    </div>

    <!-- Tabs -->
    <div
      class="rounded-2xl ring-1 ring-black/5 dark:ring-white/10 bg-white/80 dark:bg-white/5 backdrop-blur p-3 supports-[backdrop-filter]:backdrop-blur-md">
      <div role="tablist" aria-label="{% trans 'Pricing plans' %}"
        class="grid grid-cols-3 gap-2">
        <button role="tab" id="tab-monthly" aria-selected="false"
          aria-controls="panel-monthly" data-tab="monthly"
          class="plan-tab inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-medium
                 text-gray-700 dark:text-gray-200 hover:bg-white dark:hover:bg-white/10 transition focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500">
          {% trans "Monthly" %}
        </button>

        <!-- 6 Months -->
        <button role="tab" id="tab-semi" aria-selected="false"
          aria-controls="panel-semi" data-tab="semi"
          class="plan-tab inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-medium
         text-gray-700 dark:text-gray-200 hover:bg-white dark:hover:bg-white/10 transition
         focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500
         flex-col-reverse sm:flex-row gap-1 sm:gap-2">
          <span>{% trans "6 Months" %}</span>
          <span
            class="rounded-full bg-emerald-600/10 text-emerald-700 dark:text-emerald-300 px-2 py-0.5 text-xs">
            {% trans "Save vs monthly" %}
          </span>
        </button>

        <!-- Annual -->
        <button role="tab" id="tab-annual" aria-selected="true"
          aria-controls="panel-annual" data-tab="annual"
          class="plan-tab active inline-flex items-center justify-center rounded-xl px-3 py-2 text-sm font-medium
         text-gray-900 dark:text-gray-100 bg-white dark:bg-white/10 shadow transition
         focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-500
         flex-col-reverse sm:flex-row gap-1 sm:gap-2">
          <span>{% trans "Annual" %}</span>
          <span
            class="rounded-full bg-emerald-600 text-white px-2 py-0.5 text-xs">
            {% trans "Best value" %}
          </span>
        </button> </div>

      <!-- Panels -->
      <div class="mt-5 space-y-5">
        <!-- MONTHLY -->
        <div role="tabpanel" id="panel-monthly" aria-labelledby="tab-monthly"
          data-panel="monthly" hidden>
          <div class="grid md:grid-cols-3 gap-6 items-stretch">
            <div class="md:col-span-2">
              <div class="relative group h-full">
                <div
                  class="absolute -inset-[1px] rounded-2xl bg-gradient-to-br from-gray-400/40 to-emerald-400/30 opacity-60 blur transition duration-300 group-hover:opacity-100"
                  aria-hidden="true"></div>
                <div
                  class="relative h-full rounded-2xl bg-white/80 dark:bg-white/[0.06] ring-1 ring-black/10 dark:ring-white/10 p-6">
                  <h3
                    class="text-xl font-semibold text-gray-900 dark:text-gray-100">{%trans "Monthly Plan" %}</h3>
                  <p class="mt-1 text-gray-700 dark:text-gray-300">
                    {% trans "Maximum flexibility â€” cancel anytime. Full speed, obfuscation, ad & tracker blocking." %}
                  </p>
                  <ul
                    class="mt-4 space-y-2 text-sm text-gray-700 dark:text-gray-300">
                    <li>âœ“ {% trans "Unlimited bandwidth & speed" %}</li>
                    <li>âœ“ {% trans "Obfuscation that works on restricted networks" %}</li>
                    <li>âœ“ {% trans "Apps for iOS â€¢ Android â€¢ Windows â€¢ macOS â€¢ Linux" %}</li>
                    <li>âœ“ {% trans "Independently audited no-logs" %}</li>
                  </ul>
                </div>
              </div>
            </div>
            <div
              class="relative rounded-2xl bg-white/90 dark:bg-white/[0.06] ring-1 ring-black/10 dark:ring-white/10 p-6 text-center">
              <div class="text-4xl font-bold text-gray-900 dark:text-gray-100">
                {{ ui_currency_symbol }}{{ ui_monthly }}
                <span
                  class="text-base font-normal text-gray-600 dark:text-gray-300">/
                  {% trans "month" %}</span>
              </div>
              <a href="{% url 'pricing' %}?term=monthly"
                class="mt-5 inline-flex w-full justify-center rounded-xl px-4 py-2 text-white bg-gray-900 dark:bg-white dark:text-black hover:opacity-90 transition">
                {% trans "Choose Monthly" %}
              </a>
            </div>
          </div>
        </div>

        <!-- SEMI -->
        <div role="tabpanel" id="panel-semi" aria-labelledby="tab-semi"
          data-panel="semi" hidden>
          <div class="grid md:grid-cols-3 gap-6 items-stretch">
            <div class="md:col-span-2">
              <div class="relative group h-full">
                <div
                  class="absolute -inset-[1px] rounded-2xl bg-gradient-to-br from-emerald-400/40 via-indigo-400/30 to-fuchsia-400/30 opacity-70 blur transition duration-300 group-hover:opacity-100"
                  aria-hidden="true"></div>
                <div
                  class="relative h-full rounded-2xl bg-white/80 dark:bg-white/[0.06] ring-1 ring-black/10 dark:ring-white/10 p-6">
                  <h3
                    class="text-xl font-semibold text-gray-900 dark:text-gray-100">{% trans "6-Month Plan" %}</h3>
                  <p class="mt-1 text-gray-700 dark:text-gray-300">
                    {% trans "Better price per month than monthly â€” perfect middle ground." %}
                  </p>
                  <ul
                    class="mt-4 space-y-2 text-sm text-gray-700 dark:text-gray-300">
                    <li>âœ“ {% trans "Unlimited bandwidth & speed" %}</li>
                    <li>âœ“ {% trans "Private node availability on longer terms" %}</li>
                    <li>âœ“ {% trans "Ad & tracker blocking" %}</li>
                    <li>âœ“ {% trans "24/7 support" %}</li>
                  </ul>
                </div>
              </div>
            </div>
            <div
              class="relative rounded-2xl bg-white/90 dark:bg-white/[0.06] ring-1 ring-black/10 dark:ring-white/10 p-6 text-center">
              <div class="text-4xl font-bold text-gray-900 dark:text-gray-100">
                {{ ui_currency_symbol }}{{ ui_semiannual }}
                <span
                  class="text-base font-normal text-gray-600 dark:text-gray-300">/
                  {% trans "6 months" %}</span>
              </div>
              <div class="mt-2 text-sm text-gray-600 dark:text-gray-300"
                data-calc="per-month"
                data-currency="{{ ui_currency_symbol }}"
                data-total="{{ ui_semiannual }}"
                data-months="6">
              </div>
              <a href="{% url 'pricing' %}?term=semi"
                class="mt-5 inline-flex w-full justify-center rounded-xl px-4 py-2 text-white bg-emerald-600 hover:bg-emerald-500 transition">
                {% trans "Choose 6-Month" %}
              </a>
            </div>
          </div>
        </div>

        <!-- ANNUAL -->
        <div role="tabpanel" id="panel-annual" aria-labelledby="tab-annual"
          data-panel="annual">
          <div class="grid md:grid-cols-3 gap-6 items-stretch">
            <div class="md:col-span-2">
              <div class="relative group h-full">
                <div
                  class="absolute -inset-[1px] rounded-2xl bg-gradient-to-br from-emerald-500/50 via-emerald-400/40 to-emerald-300/40 opacity-80 blur transition duration-300 group-hover:opacity-100"
                  aria-hidden="true"></div>
                <div
                  class="relative h-full rounded-2xl bg-white/85 dark:bg-white/[0.07] ring-2 ring-emerald-500/60 p-6">
                  <span
                    class="inline-flex items-center rounded-full bg-emerald-600 text-white px-3 py-1 text-xs">
                    {% trans "Best value" %}</span>
                  <h3
                    class="mt-2 text-xl font-semibold text-gray-900 dark:text-gray-100">
                    {% trans "Annual Plan" %}
                  </h3>
                  <p class="mt-1 text-gray-700 dark:text-gray-300">
                    {% trans "Best price per month â€” includes private node & 30-day money-back guarantee." %}
                  </p>
                  <ul
                    class="mt-4 space-y-2 text-sm text-gray-700 dark:text-gray-300">
                    <li>âœ“ {% trans "Private node on annual plans" %}</li>
                    <li>âœ“ {% trans "30-day money-back guarantee" %}</li>
                    <li>âœ“ {% trans "Priority support" %}</li>
                    <li>âœ“ {% trans "Everything in Monthly" %}</li>
                  </ul>
                </div>
              </div>
            </div>
            <div
              class="relative rounded-2xl bg-white/90 dark:bg-white/[0.06] ring-1 ring-black/10 dark:ring-white/10 p-6 text-center">
              <div class="text-4xl font-bold text-gray-900 dark:text-gray-100">
                {{ ui_currency_symbol }}{{ ui_annual }}
                <span
                  class="text-base font-normal text-gray-600 dark:text-gray-300">/
                  {% trans "year" %}</span>
              </div>
              <div class="mt-2 text-sm text-gray-600 dark:text-gray-300"
                data-calc="per-month"
                data-currency="{{ ui_currency_symbol }}"
                data-total="{{ ui_annual }}"
                data-months="12">
              </div>
              <a href="{% url 'pricing' %}?term=annual"
                class="mt-5 inline-flex w-full justify-center rounded-xl px-4 py-2 text-white bg-emerald-600 hover:bg-emerald-500 transition">
                {% trans "Choose Annual" %}
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- SEO mini tablo -->
    <div class="mt-8 overflow-x-auto">
      <table
        class="min-w-full text-left text-sm border-separate border-spacing-y-2">
        <caption class="sr-only">{% trans "VPN pricing comparison overview" %}</caption>
        <thead class="text-gray-700 dark:text-gray-300">
          <tr>
            <th class="px-3 py-2">{% trans "Plan" %}</th>
            <th class="px-3 py-2">{% trans "CoolVPN" %}</th>
            <th class="px-3 py-2">{% trans "Typical market price" %}</th>
            <th class="px-3 py-2">{% trans "Notes" %}</th>
          </tr>
        </thead>
        <tbody class="text-gray-900 dark:text-gray-100">
          <tr class="bg-white/85 dark:bg-white/[0.06]">
            <td class="px-3 py-2">{% trans "Monthly" %}</td>
            <td class="px-3 py-2">{{ ui_currency_symbol }}{{ ui_monthly }} / {% trans "mo" %}</td>
            <td class="px-3 py-2">{% trans "Often $7â€“$13/mo" %}</td>
            <td class="px-3 py-2">{% trans "No-logs, obfuscation, ad-block included" %}</td>
          </tr>
          <tr class="bg-white/85 dark:bg-white/[0.06]">
            <td class="px-3 py-2">{% trans "6-Month" %}</td>
            <td class="px-3 py-2">{{ ui_currency_symbol }}{{ ui_semiannual }} / {% trans "6 months" %}</td>
            <td class="px-3 py-2">{% trans "Bundles typically higher than monthly Ã—6" %}</td>
            <td class="px-3 py-2">{% trans "Lower cost per month than monthly" %}</td>
          </tr>
          <tr class="bg-white/85 dark:bg-white/[0.06]">
            <td class="px-3 py-2">{% trans "Annual" %}</td>
            <td class="px-3 py-2">{{ ui_currency_symbol }}{{ ui_annual }} / {% trans "year" %}</td>
            <td class="px-3 py-2">{% trans "Annual discounts vary widely" %}</td>
            <td class="px-3 py-2">{% trans "Best long-term value" %}</td>
          </tr>
        </tbody>
      </table>
      <p class="mt-2 text-xs text-gray-600 dark:text-gray-400">
        {% trans "Market price ranges are indicative and can vary by region and provider." %}
      </p>
    </div>
  </div>
</section>

<script>
  // eriÅŸilebilir tab davranÄ±ÅŸÄ± + per-month hesap
  document.addEventListener('DOMContentLoaded', () => {
    const tabs = document.querySelectorAll('.plan-tab');
    const panels = document.querySelectorAll('[data-panel]');

    function activate(name) {
      tabs.forEach(t => {
        const on = t.dataset.tab === name;
        t.setAttribute('aria-selected', on ? 'true' : 'false');
        t.classList.toggle('active', on);
        t.classList.toggle('bg-white', on);
        t.classList.toggle('dark:bg-white/10', on);
        t.classList.toggle('text-gray-900', on);
        t.classList.toggle('dark:text-gray-100', on);
        t.classList.toggle('text-gray-700', !on);
        t.classList.toggle('dark:text-gray-200', !on);
      });
      panels.forEach(p => { p.hidden = p.dataset.panel !== name; });
    }

    // klavye yÃ¶n tuÅŸlarÄ±
    document.querySelector('[role="tablist"]')?.addEventListener('keydown', e => {
      const order = Array.from(tabs);
      const idx = order.findIndex(t => t.getAttribute('aria-selected') === 'true');
      if (['ArrowRight','ArrowLeft'].includes(e.key)) {
        e.preventDefault();
        let next = e.key === 'ArrowRight' ? (idx + 1) % order.length : (idx - 1 + order.length) % order.length;
        order[next].focus(); order[next].click();
      }
    });

    tabs.forEach(t => t.addEventListener('click', () => activate(t.dataset.tab)));
    activate('annual'); // varsayÄ±lan: yÄ±llÄ±k

    // per-month hesaplama (semi & annual)
    document.querySelectorAll('[data-calc="per-month"]').forEach(node => {
      const cur = node.dataset.currency || '';
      const total = parseFloat(node.dataset.total || '0');
      const months = parseInt(node.dataset.months || '1', 10);
      if (months > 0 && total > 0) {
        const per = total / months;
        const perStr = Number.isInteger(per) ? per.toFixed(0) : per.toFixed(2);
        node.textContent = `â‰ˆ ${cur}${perStr} / {% trans "month" %}`;
      }
    });
  });

  // hover parallax ufak efekt
  (function () {
    const box = document.querySelector('#plans > .max-w-screen-xl > .rounded-2xl');
    if (!box) return;

    const set = (x, y) => {
      box.style.setProperty('--orbx', x.toFixed(3));
      box.style.setProperty('--orby', y.toFixed(3));
    };

    const onLeave = () => { set(0, 0); };
    const onMove  = (e) => {
      const r = box.getBoundingClientRect();
      const x = ((e.clientX - r.left) / r.width) - 0.5;
      const y = ((e.clientY - r.top)  / r.height) - 0.5;
      set(x, y);
    };

    box.addEventListener('mouseleave', onLeave);
    box.addEventListener('mousemove',  onMove);
    box.addEventListener('touchstart', (ev)=> {
      const t = ev.touches[0]; if (!t) return;
      onMove({ clientX: t.clientX, clientY: t.clientY, });
    }, {passive:true});
    box.addEventListener('touchmove', (ev)=> {
      const t = ev.touches[0]; if (!t) return;
      onMove({ clientX: t.clientX, clientY: t.clientY, });
    }, {passive:true});
    box.addEventListener('touchend', onLeave, {passive:true});
  })();
</script>
